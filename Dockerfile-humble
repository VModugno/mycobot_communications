FROM ros:humble-ros-base

# sudo docker run -it --network host --device /dev/ttyAMA0 --volume /home/ubuntu/:/mnt_folder -v /dev:/dev --device-cgroup-rule "c 81:* rmw" --device-cgroup-rule "c 189:* rmw" --rm mzandtheraspberrypi/mycobot-ros2:1.1.0

ENV ROS_WORKSPACE="/ros2_ws"

RUN mkdir -p ${ROS_WORKSPACE}
ENV TMP="/tmp"
RUN mkdir -p ${TMP}
RUN mkdir -p "${ROS_WORKSPACE}/src"
WORKDIR "${ROS_WORKSPACE}/src"

# install cobot stuff

# libgl1 is hidden dep of opencv
RUN apt update && apt install git nano python3-pip python3-colcon-common-extensions libgl1 -y

RUN git clone -b msg-rename-angle-bounding https://github.com/VModugno/mycobot_communications

# opencv-python is a hidden dep of pymycobot
RUN pip install pymycobot==3.4.9 opencv-python numpy

# installing realsense stuff
RUN apt install ros-humble-librealsense2* ros-humble*-image-transport* -y
RUN apt install ros-humble-realsense2-* -y

WORKDIR ${ROS_WORKSPACE}
RUN echo ". /opt/ros/humble/setup.bash" >> /root/.bashrc
RUN /bin/bash -c '. /opt/ros/humble/setup.bash; colcon build --symlink-install'
